console.log('üöÄ JavaScriptË™≠„ÅøËæº„ÅøÈñãÂßã');
console.log('üîç „Éá„Éê„ÉÉ„Ç∞: „Çπ„ÇØ„É™„Éó„ÉàÂÆüË°å‰∏≠');

// ===== „Éá„Éº„ÇøÁÆ°ÁêÜ =====
let seoArticles = [];
let blogArticles = [];
let profileData = {};
let faqData = [];

async function loadAllData() {
    try {
        console.log('üîÑ „Éá„Éº„ÇøË™≠„ÅøËæº„ÅøÈñãÂßã...');
        
        // Ë®ò‰∫ã„Éá„Éº„ÇøË™≠„ÅøËæº„Åø
        console.log('üìö articles.jsonË™≠„ÅøËæº„Åø‰∏≠...');
        const articlesResponse = await fetch('./content/articles/articles.json');
        if (!articlesResponse.ok) {
            throw new Error(`Articles HTTP error! status: ${articlesResponse.status}`);
        }
        const articlesData = await articlesResponse.json();
        seoArticles = articlesData.seoArticles || [];
        blogArticles = articlesData.blogArticles || [];
        console.log('‚úÖ Ë®ò‰∫ã„Éá„Éº„ÇøÂèñÂæó:', seoArticles.length, 'SEO,', blogArticles.length, 'Blog');
        
        // „Éó„É≠„Éï„Ç£„Éº„É´„Éá„Éº„ÇøË™≠„ÅøËæº„Åø
        console.log('üë§ profile.jsonË™≠„ÅøËæº„Åø‰∏≠...');
        const profileResponse = await fetch('./content/profile.json');
        if (!profileResponse.ok) {
            throw new Error(`Profile HTTP error! status: ${profileResponse.status}`);
        }
        profileData = await profileResponse.json();
        console.log('‚úÖ „Éó„É≠„Éï„Ç£„Éº„É´„Éá„Éº„ÇøÂèñÂæó:', profileData.name);
        
        console.log('‚úÖ ÂÖ®„Éá„Éº„ÇøË™≠„ÅøËæº„ÅøÂÆå‰∫Ü:', {
            seoArticles: seoArticles.length,
            blogArticles: blogArticles.length,
            profile: profileData.name
        });
        
        return true;
    } catch (error) {
        console.error('‚ùå „Éá„Éº„ÇøË™≠„ÅøËæº„Åø„Ç®„É©„Éº:', error);
        return false;
    }
}

// profileData„ÅØ‰∏ä„Åßlet„ÅßÂÆ£Ë®ÄÊ∏à„Åø„ÄÅJSON„Åã„ÇâË™≠„ÅøËæº„ÇÄ

// ===== ÂàùÊúüÂåñ =====
document.addEventListener('DOMContentLoaded', async function() {
    console.log('üöÄ DOMContentLoadedÁô∫ÁÅ´');
    
    try {
        console.log('üì° ÂÖ®„Éá„Éº„ÇøË™≠„ÅøËæº„ÅøÈñãÂßã');
        const dataLoaded = await loadAllData();
        console.log('üìä „Éá„Éº„ÇøË™≠„ÅøËæº„ÅøÁµêÊûú:', dataLoaded);
        
        if (!dataLoaded) {
            console.warn('‚ö†Ô∏è Ë®ò‰∫ã„Éá„Éº„ÇøË™≠„ÅøËæº„ÅøÂ§±Êïó„ÄÅÁ©∫ÈÖçÂàó„ÅßÁ∂ôÁ∂ö');
        }
        
        console.log('üé® ÊèèÁîªÂá¶ÁêÜÈñãÂßã');
        hideLoading();
        renderProfile();
        renderServices();
        renderSkills();
        renderSeoArticles();
        renderBlogArticles();
        renderTestimonials();
        renderFAQ();
        renderContact();
        console.log('‚úÖ ÂÖ®„Å¶„ÅÆÊèèÁîªÂÆå‰∫Ü');
    } catch (error) {
        console.error('‚ùå „Ç®„É©„Éº:', error);
        hideLoading(); // „Ç®„É©„ÉºÊôÇ„Åß„ÇÇ„É≠„Éº„Éá„Ç£„É≥„Ç∞Ë°®Á§∫„ÇíÊ∂à„Åô
    }
});

// ===== ÊèèÁîªÈñ¢Êï∞ =====
function hideLoading() {
    const loadings = document.querySelectorAll('.loading');
    loadings.forEach(loading => loading.remove());
}

function renderProfile() {
    const profileText = document.querySelector('.profile-text');
    if (!profileText) return;
    
    // „Éó„É≠„Éï„Ç£„Éº„É´Âü∫Êú¨ÊÉÖÂ†±
    profileText.innerHTML = `
        <h3>${profileData.name || '„Éû„Éï„Ç£„É≥'}</h3>
        <div class="profile-title">${profileData.title || 'AI √ó SEO„É©„Ç§„Çø„Éº'}</div>
        <p>${profileData.bio || ''}</p>
        <div class="profile-stats">
            ${profileData.achievements ? profileData.achievements.map(achievement => `
                <div class="stat-item">
                    <div class="stat-number">${achievement.number}</div>
                    <div class="stat-label">${achievement.label}</div>
                </div>
            `).join('') : ''}
        </div>
        <div class="social-links">
            ${profileData.socialLinks ? profileData.socialLinks.map(link => `
                <a href="${link.url}" target="_blank" rel="noopener noreferrer" class="social-link" aria-label="${link.platform}">
                    <span style="color: ${link.color}">${link.icon}</span>
                </a>
            `).join('') : ''}
        </div>
    `;
    
    console.log('‚úÖ „Éó„É≠„Éï„Ç£„Éº„É´ÊèèÁîªÂÆå‰∫Ü');
}

function renderServices() {
    const container = document.getElementById('services-container');
    if (!container) return;
    
    container.innerHTML = '';
    
    profileData.services.forEach((service, index) => {
        const serviceCard = document.createElement('div');
        serviceCard.className = 'service-card';
        serviceCard.innerHTML = `
            <div class="service-icon">${service.icon}</div>
            <h3>${service.title}</h3>
            <p>${service.description}</p>
        `;
        container.appendChild(serviceCard);
    });
    
    console.log('‚úÖ „Çµ„Éº„Éì„ÇπÊèèÁîªÂÆå‰∫Ü');
}

function renderSeoArticles() {
    const container = document.querySelector('.seo-articles-container');
    if (!container) return;
    
    container.innerHTML = '';
    
    // ÂàùÊúüË°®Á§∫Êï∞
    let displayCount = 3;
    let isExpanded = false;
    
    function showArticles() {
        container.innerHTML = '';
        seoArticles.slice(0, displayCount).forEach(article => {
            const card = createArticleCard(article);
            container.appendChild(card);
        });
        
        // MORE„Éú„Çø„É≥Ë°®Á§∫ÔºàË®ò‰∫ã„Åå3‰ª∂„Çà„ÇäÂ§ö„ÅÑÂ†¥Âêà„ÅÆ„ÅøÔºâ
        if (seoArticles.length > 3) {
            const moreButton = document.createElement('button');
            moreButton.className = 'more-button';
            
            if (isExpanded) {
                moreButton.textContent = 'CLOSE';
                moreButton.onclick = () => {
                    displayCount = 3;
                    isExpanded = false;
                    showArticles();
                };
            } else {
                moreButton.textContent = 'MORE';
                moreButton.onclick = () => {
                    displayCount = seoArticles.length;
                    isExpanded = true;
                    showArticles();
                };
            }
            
            container.appendChild(moreButton);
        }
    }
    
    showArticles();
    console.log('‚úÖ SEOË®ò‰∫ãÊèèÁîªÂÆå‰∫Ü');
}

function renderBlogArticles() {
    const container = document.querySelector('.blog-articles-container');
    if (!container) return;
    
    container.innerHTML = '';
    
    // ÂàùÊúüË°®Á§∫Êï∞
    let displayCount = 3;
    let isExpanded = false;
    
    function showArticles() {
        container.innerHTML = '';
        blogArticles.slice(0, displayCount).forEach(article => {
            const card = createArticleCard(article);
            container.appendChild(card);
        });
        
        // MORE„Éú„Çø„É≥Ë°®Á§∫ÔºàË®ò‰∫ã„Åå3‰ª∂„Çà„ÇäÂ§ö„ÅÑÂ†¥Âêà„ÅÆ„ÅøÔºâ
        if (blogArticles.length > 3) {
            const moreButton = document.createElement('button');
            moreButton.className = 'more-button';
            
            if (isExpanded) {
                moreButton.textContent = 'CLOSE';
                moreButton.onclick = () => {
                    displayCount = 3;
                    isExpanded = false;
                    showArticles();
                    // CLOSE„Éú„Çø„É≥Êäº‰∏ãÊôÇ„Å´„Çª„ÇØ„Ç∑„Éß„É≥„ÅÆ‰∏äÈÉ®„Å´„Çπ„ÇØ„É≠„Éº„É´
                    document.getElementById('blog-articles').scrollIntoView({ behavior: 'smooth' });
                };
            } else {
                moreButton.textContent = 'MORE';
                moreButton.onclick = () => {
                    displayCount = blogArticles.length;
                    isExpanded = true;
                    showArticles();
                };
            }
            
            container.appendChild(moreButton);
        }
    }
    
    showArticles();
    console.log('‚úÖ „Éñ„É≠„Ç∞Ë®ò‰∫ãÊèèÁîªÂÆå‰∫Ü');
}

function createArticleCard(article) {
    const card = document.createElement('article');
    card.className = 'article-card';
    
    const formattedDate = new Date(article.date).toLocaleDateString('ja-JP');
    
    card.innerHTML = `
        <div class="article-thumbnail">
            <img src="${article.thumbnail}" alt="${article.title}" loading="lazy">
        </div>
        <div class="article-content">
            <h3>${article.title}</h3>
            <div class="article-meta">
                <span class="article-date">${formattedDate}</span>
            </div>
            <p class="article-description">${article.description}</p>
            <div class="article-tags">
                ${(article.tags && Array.isArray(article.tags)) ? article.tags.map(tag => `<span class="tag">${tag}</span>`).join('') : ''}
            </div>
            <a href="${article.url}" target="_blank" rel="noopener noreferrer" class="read-more">
                Ë®ò‰∫ã„ÇíË™≠„ÇÄ
            </a>
        </div>
    `;
    
    return card;
}

function renderFAQ() {
    const container = document.querySelector('.faq-container');
    if (!container) return;
    
    // profileData.faq„Åã„Çâ„Éá„Éº„Çø„ÇíÂèñÂæó
    const faqData = profileData.faq || [];
    
    container.innerHTML = '';
    
    faqData.forEach((faq, index) => {
        const faqItem = document.createElement('div');
        faqItem.className = 'faq-item';
        faqItem.innerHTML = `
            <div class="faq-question" onclick="toggleFAQ(${index})">
                <span>${faq.question}</span>
                <span class="faq-toggle">+</span>
            </div>
            <div class="faq-answer" id="faq-answer-${index}">
                ${faq.answer}
            </div>
        `;
        container.appendChild(faqItem);
    });
    
    console.log('‚úÖ FAQÊèèÁîªÂÆå‰∫Ü');
}

function renderSkills() {
    const profileContainer = document.querySelector('.profile-container');
    if (!profileContainer || !profileData.skills) return;
    
    // „Çπ„Ç≠„É´„Çª„ÇØ„Ç∑„Éß„É≥„ÇíËøΩÂä†
    const skillsSection = document.createElement('div');
    skillsSection.className = 'skills-section';
    skillsSection.innerHTML = `
        <h3 class="skills-title">SKILLS</h3>
        <div class="skills-grid">
            ${profileData.skills.map(skill => `
                <div class="skill-item">
                    <div class="skill-header">
                        <span class="skill-name">${skill.name}</span>
                        <span class="skill-level">${skill.level}%</span>
                    </div>
                    <div class="skill-bar">
                        <div class="skill-progress" style="width: ${skill.level}%"></div>
                    </div>
                </div>
            `).join('')}
        </div>
    `;
    
    profileContainer.appendChild(skillsSection);
    console.log('‚úÖ „Çπ„Ç≠„É´ÊèèÁîªÂÆå‰∫Ü');
}

function renderTestimonials() {
    const blogSection = document.getElementById('blog-articles');
    if (!blogSection || !profileData.testimonials) return;
    
    // „ÅäÂÆ¢Êßò„ÅÆÂ£∞„Çª„ÇØ„Ç∑„Éß„É≥„Çí‰ΩúÊàê
    const testimonialsSection = document.createElement('section');
    testimonialsSection.id = 'testimonials';
    testimonialsSection.innerHTML = `
        <h2>TESTIMONIALS</h2>
        <p style="text-align: center; color: var(--secondary-color); margin-bottom: var(--spacing-xl); font-size: 12px; text-transform: uppercase; letter-spacing: 1px;">Client Reviews & Feedback</p>
        <div class="testimonials-container">
            ${profileData.testimonials.map(testimonial => `
                <div class="testimonial-card">
                    <div class="testimonial-content">
                        <p class="testimonial-text">"${testimonial.text}"</p>
                        <div class="testimonial-author">
                            <strong>${testimonial.author}</strong>
                            <span>${testimonial.company}</span>
                        </div>
                    </div>
                </div>
            `).join('')}
        </div>
    `;
    
    // blog-articles„Çª„ÇØ„Ç∑„Éß„É≥„ÅÆÂæå„Å´ÊåøÂÖ•
    blogSection.parentNode.insertBefore(testimonialsSection, blogSection.nextSibling);
    console.log('‚úÖ „ÅäÂÆ¢Êßò„ÅÆÂ£∞ÊèèÁîªÂÆå‰∫Ü');
}

function renderContact() {
    const container = document.querySelector('.contact-container');
    if (!container) return;
    
    const contactInfo = profileData.contact || {};
    const email = contactInfo.email || '0527muffin1203@gmail.com';
    const message = contactInfo.message || '„Åä‰ªï‰∫ã„ÅÆ„Åî‰æùÈ†º„Éª„ÅäË¶ãÁ©ç„ÇÇ„Çä„Å´„Å§„ÅÑ„Å¶„ÅØ‰∏ãË®ò„Éï„Ç©„Éº„É†„Çà„Çä„ÅäÊ∞óËªΩ„Å´„ÅäÂïè„ÅÑÂêà„Çè„Åõ„Åè„Å†„Åï„ÅÑ„ÄÇ';
    
    container.innerHTML = `
        <div class="contact-intro">
            <p>${message}</p>
            <p>„Éï„Ç©„Éº„É†„ÅåÈÄÅ‰ø°„Åß„Åç„Å™„ÅÑÂ†¥Âêà„ÅØÁõ¥Êé•„É°„Éº„É´Ôºà<a href="mailto:${email}">${email}</a>Ôºâ„Åß„ÅîÈÄ£Áµ°„Åè„Å†„Åï„ÅÑ„ÄÇ</p>
        </div>
        
        <form class="contact-form" onsubmit="handleContactForm(event)">
            <div class="form-group">
                <label class="form-label" for="name">„ÅäÂêçÂâç *</label>
                <input type="text" id="name" name="name" class="form-input" required>
            </div>
            
            <div class="form-group">
                <label class="form-label" for="email">„É°„Éº„É´„Ç¢„Éâ„É¨„Çπ *</label>
                <input type="email" id="email" name="email" class="form-input" required>
            </div>
            
            <div class="form-group">
                <label class="form-label" for="message">Ê°à‰ª∂Ë©≥Á¥∞ *</label>
                <textarea id="message" name="message" class="form-textarea" required placeholder="„ÉªË®ò‰∫ã„ÅÆ„ÉÜ„Éº„Éû„ÇÑÂÜÖÂÆπ&#10;„ÉªÊÉ≥ÂÆöÊñáÂ≠óÊï∞&#10;„Éª„Çø„Éº„Ç≤„ÉÉ„ÉàË™≠ËÄÖ&#10;„Éª„Åù„ÅÆ‰ªñ„ÅîË¶ÅÊúõ„Å™„Å©Ë©≥„Åó„Åè„ÅäËÅû„Åã„Åõ„Åè„Å†„Åï„ÅÑ"></textarea>
            </div>
            
            <button type="submit" class="form-submit">ÈÄÅ‰ø°„Åô„Çã</button>
        </form>
    `;
    
    console.log('‚úÖ „Ç≥„É≥„Çø„ÇØ„ÉàÊèèÁîªÂÆå‰∫Ü');
}

// ===== FAQÊ©üËÉΩ =====
function toggleFAQ(index) {
    const answer = document.getElementById(`faq-answer-${index}`);
    const toggle = answer.previousElementSibling.querySelector('.faq-toggle');
    
    if (answer.classList.contains('active')) {
        answer.classList.remove('active');
        toggle.textContent = '+';
    } else {
        // ‰ªñ„ÅÆFAQ„ÇíÈñâ„Åò„Çã
        document.querySelectorAll('.faq-answer.active').forEach(openAnswer => {
            openAnswer.classList.remove('active');
            openAnswer.previousElementSibling.querySelector('.faq-toggle').textContent = '+';
        });
        
        answer.classList.add('active');
        toggle.textContent = '√ó';
    }
}

// ===== „Ç≥„É≥„Çø„ÇØ„Éà„Éï„Ç©„Éº„É† =====
function handleContactForm(event) {
    event.preventDefault();
    
    const formData = new FormData(event.target);
    const name = formData.get('name');
    const email = formData.get('email');
    const message = formData.get('message');
    
    if (!name || !email || !message) {
        alert('ÂøÖÈ†àÈ†ÖÁõÆ„Çí„Åô„Åπ„Å¶ÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ');
        return;
    }
    
    const subject = `„Äê„Éù„Éº„Éà„Éï„Ç©„É™„Ç™„Çµ„Ç§„Éà„Äë„ÅäÂïè„ÅÑÂêà„Çè„Åõ - ${name}Êßò`;
    const emailBody = `„Äê„ÅäÂêçÂâç„Äë${name}\n„Äê„É°„Éº„É´„Ç¢„Éâ„É¨„Çπ„Äë${email}\n\n„ÄêÊ°à‰ª∂Ë©≥Á¥∞„Äë\n${message}`;
    
    const mailtoLink = `mailto:0527muffin1203@gmail.com?subject=${encodeURIComponent(subject)}&body=${encodeURIComponent(emailBody)}`;
    window.location.href = mailtoLink;
    
    event.target.reset();
    alert('„É°„Éº„É´„ÇØ„É©„Ç§„Ç¢„É≥„Éà„ÅåÈñã„Åç„Åæ„Åô„ÄÇÈÄÅ‰ø°„Çí„ÅäÈ°ò„ÅÑ„ÅÑ„Åü„Åó„Åæ„Åô„ÄÇ');
}

console.log('‚úÖ JavaScriptË™≠„ÅøËæº„ÅøÂÆå‰∫Ü');
# 📋 マフィンブログ記事作成_完全自動化ルール v2.0（根本見直し版）

## 🚨 **重要な変更：真の完全自動化システム**

**従来の問題**: Phase Cの手動実行、URL連携の欠如、作業漏れ頻発
**新システム**: URL入力検出 → 全フェーズ自動実行 → ポートフォリオ反映まで完全自動

---

## 🎯 **新トリガー条件（URL検出による完全自動実行）**

### **最優先トリガー：WordPress URL検出**
```
ユーザーがWordPress記事URLを投稿した瞬間 → 完全自動実行開始

対応URL形式:
- https://muffin-blog.com/記事スラッグ/
- https://muffin-blog.com/?p=記事ID
- muffin-blog.com/記事スラッグ/ (httpsなしでも対応)
```

### **従来の記事作成トリガー（継続）**
```
- 「マフィンブログの記事を作って」
- NotebookLM要約の提供
- 記事作成依頼
```

---

## ⚡ **新自動実行シーケンス（URL検出型）**

### **WordPress URL検出時の完全自動実行**
```python
# 自動実行フロー
def url_detection_flow(user_message):
    """URL検出 → 完全自動実行"""
    
    # Step 1: URL検出
    url = detect_wordpress_url(user_message)
    if not url:
        return normal_workflow()
    
    # Step 2: 記事情報自動抽出
    article_info = extract_article_info_from_url(url)
    
    # Step 3: ポートフォリオ自動更新
    update_portfolio_articles_json(article_info)
    
    # Step 4: Git自動コミット・プッシュ
    git_commit_and_push_portfolio(article_info)
    
    # Step 5: Vercelデプロイ待機
    wait_for_vercel_deployment()
    
    # Step 6: 完了報告
    return generate_completion_report(article_info)
```

---

## 🔄 **新Phaseシステム（URL検出型専用）**

### **Phase Auto-A: URL自動解析**
```python
✅ WordPress記事URL検出
✅ 記事タイトル自動抽出  
✅ メタディスクリプション自動抽出
✅ タグ自動生成（記事内容ベース）
✅ 日付自動設定（実行日）
```

### **Phase Auto-B: ポートフォリオ自動更新**
```python
✅ articles.json読み込み
✅ 重複記事の自動削除
✅ 新記事を最上位に自動挿入
✅ JSON形式の自動検証
✅ ファイル自動保存
```

### **Phase Auto-C: Git自動操作**
```python
✅ git add . 自動実行
✅ コミットメッセージ自動生成
✅ git commit自動実行
✅ git push origin master自動実行
✅ プッシュ成功確認
```

### **Phase Auto-D: デプロイ自動待機**
```python
✅ Vercel自動デプロイ開始確認
✅ デプロイ完了まで自動待機（180秒）
✅ ポートフォリオサイト反映確認
✅ 全工程完了通知
```

---

## 🤖 **Claude実行時の自動判定システム**

### **メッセージ受信時の自動判定**
```python
def claude_message_handler(user_message):
    """Claude受信時の完全自動判定"""
    
    # 優先度1: WordPress URL検出
    if wordpress_url_detected(user_message):
        return execute_url_automation(user_message)
    
    # 優先度2: 記事作成依頼
    elif blog_creation_request(user_message):
        return execute_article_creation_workflow()
    
    # 優先度3: 通常対応
    else:
        return normal_response(user_message)
```

### **URL検出パターン**
```regex
URL検出正規表現:
1. https://muffin-blog\.com/[^/\s]+/?
2. https://muffin-blog\.com/\?p=\d+  
3. muffin-blog\.com/[^/\s]+/?

検出例:
✅ "記事完成しました https://muffin-blog.com/new-article/"
✅ "URL: https://muffin-blog.com/?p=3000"
✅ "muffin-blog.com/sample-post 確認してください"
```

---

## 🔧 **自動実行システム詳細仕様**

### **記事情報自動抽出システム**
```python
def extract_article_info(url):
    """WordPress記事から自動抽出"""
    
    # 1. WebFetchで記事内容取得
    content = fetch_wordpress_content(url)
    
    # 2. タイトル自動抽出
    title = extract_title_from_html(content)
    
    # 3. メタディスクリプション自動抽出
    description = extract_meta_description(content)
    
    # 4. タグ自動生成
    tags = generate_tags_from_content(title, description, content)
    
    # 5. 構造化データ生成
    return {
        "title": title,
        "url": url,
        "description": description,
        "date": datetime.now().strftime("%Y-%m-%d"),
        "tags": tags
    }
```

### **ポートフォリオ自動更新システム**
```python
def update_portfolio_auto(article_info):
    """articles.json自動更新"""
    
    # 1. 既存データ読み込み
    articles_data = load_articles_json()
    
    # 2. 重複削除（同じURL）
    articles_data["blogArticles"] = remove_duplicates(articles_data["blogArticles"], article_info["url"])
    
    # 3. 新記事を最上位に挿入
    articles_data["blogArticles"].insert(0, article_info)
    
    # 4. JSON保存
    save_articles_json(articles_data)
    
    return True
```

### **Git自動操作システム**
```python
def git_auto_commit_push(article_title):
    """Git操作完全自動化"""
    
    # 1. 作業ディレクトリ変更
    os.chdir("/Users/satoumasamitsu/osigoto/ポートフォリオサイト/")
    
    # 2. Git add
    subprocess.run(["git", "add", "."])
    
    # 3. コミットメッセージ自動生成
    commit_msg = f"【新記事自動追加】{article_title}\n\n- 完全自動化システムによる自動更新\n- articles.json更新完了"
    
    # 4. Git commit
    subprocess.run(["git", "commit", "-m", commit_msg])
    
    # 5. Git push
    subprocess.run(["git", "push", "origin", "master"])
    
    return True
```

---

## 🚨 **Claude強制実行ルール（絶対遵守）**

### **URL検出時の強制実行**
```
🔴 絶対実行ルール:
1. WordPress URLを検出した瞬間に完全自動化ワークフローを開始する
2. ユーザーの確認や追加指示を待たない
3. 全Phase（Auto-A〜Auto-D）を連続実行する
4. エラー発生時は即座にエラー報告と対処を行う
5. 完了まで他の作業に移らない
```

### **実行順序の絶対遵守**
```
必須実行順序:
Phase Auto-A → Phase Auto-B → Phase Auto-C → Phase Auto-D → 完了報告

スキップ・並行実行・順序変更は一切禁止
```

### **エラーハンドリング**
```python
def error_handling(phase, error):
    """エラー発生時の自動対処"""
    
    if phase == "Auto-A":
        # 記事情報抽出失敗
        return retry_with_different_method()
    
    elif phase == "Auto-B": 
        # JSON更新失敗
        return backup_and_retry()
    
    elif phase == "Auto-C":
        # Git操作失敗  
        return resolve_git_conflict()
    
    elif phase == "Auto-D":
        # デプロイ失敗
        return manual_verification_request()
```

---

## 📊 **従来システムとの比較**

### **従来システム（問題だらけ）**
```
❌ Phase C手動実行 → 作業漏れ頻発
❌ URL連携なし → ポートフォリオ未反映  
❌ Git操作手動 → プッシュ忘れ
❌ Vercel確認手動 → 反映確認漏れ
❌ ルール形骸化 → 実際に自動化されない
```

### **新システム（完全自動）**  
```
✅ URL検出 → 全自動実行開始
✅ 記事情報 → 自動抽出・構造化
✅ ポートフォリオ → 自動更新・重複削除
✅ Git操作 → 自動コミット・プッシュ
✅ デプロイ → 自動待機・完了確認
✅ 報告 → 全工程結果の自動通知
```

---

## 🎯 **新システムの使用方法**

### **ユーザー側（超簡単）**
```
1. WordPress記事を作成・公開
2. 完成URLをClaude Codeに送信
3. 全て自動実行される（何もしなくて良い）
4. 完了報告を確認
```

### **実際の使用例**
```
ユーザー: "記事できました https://muffin-blog.com/new-post/"

Claude: 🎯 WordPress URL検出: https://muffin-blog.com/new-post/
        🚀 完全自動化ワークフロー開始...
        
        📊 Phase Auto-A: 記事情報自動抽出
        ✅ タイトル: 新しい記事タイトル
        ✅ 説明: 記事の説明文...
        ✅ タグ: [tag1, tag2, tag3]
        
        🔄 Phase Auto-B: ポートフォリオarticles.json更新
        ✅ 重複記事削除完了
        ✅ 新記事を最上位に追加完了
        
        📤 Phase Auto-C: ポートフォリオサイトGitプッシュ
        ✅ Git add完了
        ✅ Git commit完了  
        ✅ Git push完了
        
        ⏳ Phase Auto-D: Vercelデプロイ待機
        ✅ デプロイ完了推定
        
        🎉 完全自動化ワークフロー成功！
        ✅ ポートフォリオサイト: https://muffin-portfolio-public.vercel.app
```

---

## 📁 **ファイル構成の更新**

### **新規追加ファイル**
```
/システム実行ファイル/コア/
├── 完全自動化ワークフローシステム.py ←【NEW】
├── URL検出システム.py ←【NEW】  
├── ポートフォリオ自動更新システム.py ←【NEW】
└── Git自動操作システム.py ←【NEW】
```

### **更新ファイル**
```
/ドキュメント/プロジェクト管理文書/
├── マフィンブログ記事作成_完全自動化ルール_v2.md ←【UPDATE】
└── 旧ルールファイル → アーカイブ化
```

---

## 🚨 **Claude（私）への最終指示**

### **メッセージ受信時の絶対実行事項**
```
1. 【URL検出チェック】毎回必ず最初に実行
2. 【URL発見時】即座に完全自動化ワークフロー開始
3. 【途中中断禁止】Phase Auto-A〜Dまで連続実行
4. 【完了報告必須】全工程の結果を詳細報告
5. 【エラー対応】発生時は即座に対処・報告
```

### **このルールの適用開始**
```
適用開始: このルール保存時点から即座
対象: 全てのユーザーメッセージ
例外: なし（必ず最初にURL検出チェック実行）
```

---

## 📈 **期待される効果**

### **ユーザー体験の劇的改善**
- URL送信 → 全自動実行（作業ゼロ）
- 作業漏れゼロ（システムが全て実行）
- 即座反映（手動確認不要）

### **システム品質の向上**  
- 人的ミス排除（完全自動化）
- 一貫した品質（標準化されたフロー）
- トレーサビリティ（全工程ログ記録）

### **開発効率の向上**
- Phase C忘れなし（自動実行）
- Git操作忘れなし（自動実行）  
- ポートフォリオ反映保証（自動実行）

---

**🚀 真の完全自動化システム始動！**